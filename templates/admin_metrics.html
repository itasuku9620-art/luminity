{% extends "base.html" %}
{% block title %}KPIパネル{% endblock %}

{% block content %}
<section class="container" style="max-width:1100px;margin:1.5rem auto;">
  <h1 class="page-title" style="margin-bottom:1rem;">軽量KPIパネル</h1>

  <!-- 上部カード -->
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:12px;">
    <div class="card" style="background:#fff;box-shadow:0 6px 16px rgba(0,0,0,.06);border-radius:16px;padding:16px;">
      <div style="color:#777;font-size:.9rem;">ユーザー数</div>
      <div style="font-size:1.8rem;font-weight:800;">{{ total_users }}</div>
    </div>
    <div class="card" style="background:#fff;box-shadow:0 6px 16px rgba(0,0,0,.06);border-radius:16px;padding:16px;">
      <div style="color:#777;font-size:.9rem;">投稿数</div>
      <div style="font-size:1.8rem;font-weight:800;">{{ total_posts }}</div>
    </div>
    <div class="card" style="background:#fff;box-shadow:0 6px 16px rgba(0,0,0,.06);border-radius:16px;padding:16px;">
      <div style="color:#777;font-size:.9rem;">コメント数</div>
      <div style="font-size:1.8rem;font-weight:800;">{{ total_comments }}</div>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
    <!-- 直近7日 新規ユーザー -->
    <div class="card" style="background:#fff;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:12px;">
      <div style="font-weight:700;margin-bottom:.3rem;">直近7日の新規ユーザー</div>
      <table style="width:100%;border-collapse:collapse;">
        <thead><tr><th style="text-align:left;padding:.35rem .5rem;border-bottom:1px solid #eee;">日付</th><th style="text-align:right;padding:.35rem .5rem;border-bottom:1px solid #eee;">件数</th></tr></thead>
        <tbody>
          {% for r in new_users_7d %}
          <tr>
            <td style="padding:.35rem .5rem;border-bottom:1px solid #f6f6f6;">{{ r.date }}</td>
            <td style="padding:.35rem .5rem;border-bottom:1px solid #f6f6f6;text-align:right;">{{ r.count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- 直近7日 投稿 -->
    <div class="card" style="background:#fff;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:12px;">
      <div style="font-weight:700;margin-bottom:.3rem;">直近7日の投稿数</div>
      <table style="width:100%;border-collapse:collapse;">
        <thead><tr><th style="text-align:left;padding:.35rem .5rem;border-bottom:1px solid #eee;">日付</th><th style="text-align:right;padding:.35rem .5rem;border-bottom:1px solid #eee;">件数</th></tr></thead>
        <tbody>
          {% for r in new_posts_7d %}
          <tr>
            <td style="padding:.35rem .5rem;border-bottom:1px solid #f6f6f6;">{{ r.date }}</td>
            <td style="padding:.35rem .5rem;border-bottom:1px solid #f6f6f6;text-align:right;">{{ r.count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="card" style="background:#fff;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:12px;margin-bottom:16px;">
    <div style="font-weight:700;margin-bottom:.3rem;">直近14日の通報件数</div>
    <table style="width:100%;border-collapse:collapse;">
      <thead><tr><th style="text-align:left;padding:.35rem .5rem;border-bottom:1px solid #eee;">日付</th><th style="text-align:right;padding:.35rem .5rem;border-bottom:1px solid #eee;">件数</th></tr></thead>
      <tbody>
        {% for r in reports_14d %}
        <tr>
          <td style="padding:.35rem .5rem;border-bottom:1px solid #f6f6f6;">{{ r.date }}</td>
          <td style="padding:.35rem .5rem;border-bottom:1px solid #f6f6f6;text-align:right;">{{ r.count }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card" style="background:#fff;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:12px;">
    <div style="font-weight:700;margin-bottom:.3rem;">お気に入り上位店舗</div>
    <table style="width:100%;border-collapse:collapse;">
      <thead><tr><th style="text-align:left;padding:.35rem .5rem;border-bottom:1px solid #eee;">店舗</th><th style="text-align:right;padding:.35rem .5rem;border-bottom:1px solid #eee;">お気に入り</th></tr></thead>
      <tbody>
        {% if top_favs and top_favs|length > 0 %}
          {% for s in top_favs %}
          <tr>
            <td style="padding:.35rem .5rem;border-bottom:1px solid #f6f6f6;">
              <a href="{{ url_for('store_detail', store_id=s.store_id) }}" target="_blank">{{ s.name }}</a>
              <span style="color:#999;margin-left:.4rem;">#{{ s.store_id }}</span>
            </td>
            <td style="padding:.35rem .5rem;border-bottom:1px solid #f6f6f6;text-align:right;">{{ s.count }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="2" style="padding:.6rem;color:#777;">データがありません。</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <div style="margin-top:1rem;">
    <a href="{{ url_for('admin_dashboard') }}" class="btn"
       style="display:inline-block;padding:.6rem 1rem;border-radius:999px;background:#fff;border:1px solid #ddd;text-decoration:none;">
      ← ダッシュボードに戻る
    </a>
  </div>
</section>
{% endblock %}
